## 一 日志配置

#### 1.1 日志基础配置

日志配置位于http下：

```
    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
    #                  '$status $body_bytes_sent "$http_referer" '
    #                  '"$http_user_agent" "$http_x_forwarded_for"';

    #access_log  logs/access.log  main;
```
上述的`main`是日志记录形式的自定义名称，其中remote_addr是远程访问地址，后续依次是用户名，访问时间，请求方式（get/post等）等等。  

nginx允许针对不同的server做不同的日志处理：
```
server {
    access_log logs/test.log main       # 在指定的server下添加，需要打开http配置下的main名称
}
```

#### 1.2 日志切割

在日志目录下书写一个shell脚本：
```
vim runlog.sh

# 内容容下，运行方式 ssh runlog.sh
#!/bin/bash

LOGPATH=/usr/local/nginx/logs/test.log

## 一个月一个目录
BASEPATH=$BASEPATH/$(date -d yesterday +%Y%m)

mkdir -p $BASEPATH

bak=$BASEPATH/$(date -d yesterdata +%Y%m$d%H%M).test.log

mv $LOGPATH $bak

touch $LOGPATH

kill -USR1 `cat /usr/local/nginx/logs/nginx.pid`
```

让该shell每分钟执行一次（生产环境每天执行一次或者按需求执行），命令行输入以下命令：
```
crontab -e 

# 添加以下内容
*/1 * * * * sh /usr/local/nginx/runlog.sh
```
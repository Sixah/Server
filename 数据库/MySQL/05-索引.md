## 一 索引概念

通过索引对象，可以快速查询到数据库对象表中的特定记录，是提高性能的常用方式。  

索引其实和书的目录类似，索引创建在表对象上，由表中的一个或者多个字段生成的键组成，键以B-树或者哈希表存储，所以也分为B树索引和哈希索引。InnoDB和MyISAM支持B-树索引，MEMORY支持哈希索引。  

索引虽然提高了速度，但是也响应增加了存储空间，数据检索如果大于100ms就可以开始考虑优化了。主要优化where后面的语句。  


下列字段经常作为索引：
- 经常被查询的字段，即在where中经常出现的字段
- 分组的字段，即在group by中出现的字段
- 存在依赖关系的子表和父表之间的联合查询，即主键和外键字段
- 设置唯一完整性约束的字段

以下字段不适合创建索引：
- 在查询中很少被使用的字段；
- 拥有许多重复值的字段

索引优缺点：
- 优点：大大提高查询速度
- 缺点：降低了更新速度，如insert、update、delete，因为更新时不仅要保存新数据，还要保存索引文件。同时，索引页会占据一定的磁盘索引文件。

## 二 索引使用

#### 2.1 创建索引

建表时候创建索引：
```
create table 表名 (
  字段名 数据类型,
  ....
  index [索引名](字段名 [长度] [asc|desc])
);
```

在已经存在的表上创建普通索引：
```
# 两种方式
create index 索引名 on 表名(字段名 [(长度)] [asc|desc]);
alter table 表名 add index 索引名(字段名 [(长度)] [asc|desc]);

# 示例
create index index_name on t_users(name);
```

注意：
- 因为不同引擎定义了表最大索引数和最大长度，所以可以设长度，mysql所支持的存储引擎对每个表至少支持16个索引，总索引长度至少为256个字节。
- 索引名最好以index_开头

#### 2.2 索引查看与检索

查看索引：
```
show index from table_name;
```

检测索引：
```
explain select * from users where name='lisi';		        # 如果name被建立了索引，则查询速度变快
```

#### 2.3 索引删除

删除索引：
```
drop index 索引名 on 表名;
```

## 三 特殊索引

#### 3.1 唯一索引

唯一索引就是在创建索引时，限制索引的值必须是唯一的。  

在MySQL中，根据创建索引的方式，可分为自动索引和手动索引:
- 自动索引：在数据库表里设置完整约束时，该表会被系统自动创建索引；
- 手动索引：手动在表上创建索引

创建表时创建唯一索引：
```
create table 表名 (
字段名 数据类型,
....
unique index [索引名](字段名 [(长度)] [asc|desc]);
);
```

在表上创建唯一索引：
```
create uinque index 索引名 on 表名 (字段名 [(长度)] [asc|desc]);
```

alter table创建唯一索引：
```
alter table 表名add unique index 索引名 (字段名 [(长度)] [asc|desc]); 
```

#### 3.2 全文索引

全文索引主要关联自数据类型为字符串的字段上，以便能够快速的查询数据量较大的字符串类型的字段，只有MyISAM引擎支持。   

默认情况下，全文索引的执行不区分大小写，如果全文索引所关联的字段为二进制数据类型，则区分大小写。  

全文索引与唯一索引同样有三种创建方式，区别是使用关键字 fulltext代替unique。  

#### 3.3 多列索引

多列索引是指在创建索引时，关联了多个字段，但是只有查询条件中使用了所关联字段中的第一个字段，多列索引才会被使用。  

创建方式同样有三种，只是字段处可以添加多个。

## 四 索引设计原则

- 最适合索引的类是在where中的列，或者连接子句中的列，而不是select后的查询的列
- 使用唯一索引：索引列的基数越大，索引效果越好。如：存放出生日期的列具有不同的值很容易区分各行，而记录性别的列，只有M/F，对这种列索引用处不大因为会搜索出大半行数据
- 使用短索引：对字符串列进行索引，应指定一个前缀长度。如：有一个CHAR(200)的列，如果在前20个字符内，多数值唯一，那么就不要对整个列索引，对前20个索引能节省大量索引空间，查询也可能更快（占用少，IO也快）
- 利用最左前缀：在创建一个n列的索引时，实际是创建了数据库可利用的n个索引，多列索引可起几个索引的作用，因为可利用索引中最左边的列集来匹配行，这样的列集称为最左前缀
- 不要过度索引：索引占用空间，并会降低写性能。
- InnoDB的主键即是索引，尽量使用较短的数据类型，可以有效减少索引的磁盘占用，以提高索引的缓存效果。

## 五 BTREE索引和HASH索引

MEMORY存储引擎的表可以选择使用BTREE或HASH索引。
- HASH索引：只能使用整个关键字来搜索一行，且只适用于使用=和<=>比较。同时，ORDER BY操作不能被加速，且范围查询会影响一些查询的效率。
- BTREE索引：适用范围广，也适用于范围查询



